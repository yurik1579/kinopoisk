(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3284],{3284:function(e,o,t){"use strict";t.r(o),t.d(o,{PaymentManager:function(){return x}});var a=t(37667),n=t(53657),r=t(88211),i=t.n(r),l=t(77418),s=t(3134),d=t(47474),u=t(60106),c=t(79933),p=t(16144),m=t(60608),f=t(13282),v=t(76894),g=t(56591),y=t(38190),h=t(59968),O=t(79337),S=t(62207),_=t(45437),b=t(27717),N=t(47230),W=t.n(N),w=t(90680),C=t(50529),k=t(67300);const P=(0,b.nanoid)();var F=t(62944);const E=()=>{var e,o;const t=(0,O.useRouter)(),{billingFeatureName:n,target:r,shouldOpenWidgetFromQuery:i,queryWithoutPWOptions:l}=(0,F.J)(),s=(0,S.C7)();if(!s)throw new Error("There are no routes in the context");const d=s.matchUrl(window.location.href),u=(null===(e=d.route)||void 0===e?void 0:e.routeName)||_.C.Main,c=s.getPage((null===(o=d.route)||void 0===o?void 0:o.routeName)||_.C.Main),p=s.getUrl(u,{params:d.params,query:l}),m=(0,a.useCallback)((()=>t.replace({pathname:c,query:l},p,{shallow:!0})),[t]),f=(e=>{var o,t,n,r;let{billingFeatureName:i="",target:l="",shouldSkipOffer:s,onOpenWidget:d=W(),onEmptyOffer:u,onCloseWidget:c=W()}=e;const{data:p,loading:m}=(0,C.G)(w.o,{variables:{features:[i],target:l},skip:s}),{batchPositionId:f,offers:v=[]}=null!==(o=null===p||void 0===p?void 0:p.subscriptionCompositeOffers)&&void 0!==o?o:{},{compositeOffer:g}=null!==(t=v[0])&&void 0!==t?t:{},y=null===g||void 0===g||null===(n=g.tariffOffer)||void 0===n?void 0:n.name,h=null===g||void 0===g||null===(r=g.optionOffers[0])||void 0===r?void 0:r.name,O=!y&&!h;(0,a.useEffect)((()=>{!O||m||s||u()}),[O,m,s]);const S=(0,a.useCallback)((()=>{d()}),[]),_=(0,k.$)({offerName:null!==y&&void 0!==y?y:"",offersPositionId:null===g||void 0===g?void 0:g.positionId,optionName:null!==h&&void 0!==h?h:"",offersBatchId:null!==f&&void 0!==f?f:"",targetMB:l,hashOrderId:P,sendOptions:!1,onTrySubscription:S,onCloseWidget:c});return O?void 0:_})({billingFeatureName:n,target:r,shouldSkipOffer:!i,onCloseWidget:m,onEmptyOffer:m});return i?f:void 0};var I=t(61144),T=t.n(I),j=t(42908);const x=(0,c.XJ)((()=>{const{0:e,1:o}=(0,a.useState)(!1),{0:t,1:r}=(0,a.useState)(!1),c=(0,n.useSelector)(m.Vz),O=(0,n.useDispatch)(),S=(0,u.nP)()===p.ViewportSizes.Small,_=()=>{O((0,s.j_)()),o(!0),document.body.style.overflow="hidden"},b=()=>{document.body.style.overflow="auto",O((0,s.TA)()),o(!1)},N=e=>{var o;e.type===f.PaymentManagerSuccessType.PurchaseData&&((null===(o=e.selectedOption)||void 0===o?void 0:o.scenario)===f.ScenarioType.Subscription&&O((0,h.U)()))},W=E();return(0,a.useEffect)((()=>{(async()=>{await g.j.init({targetNodeSelector:`#${v.Zu}`,testIds:c.join(),onOpenWidget:_,onCloseWidget:b,onCloseAfterSuccess:b,onSuccessPurchase:N,widgetType:S?v.bX:void 0,serviceId:l.x,filterStreams:"false",lang:y.Bt,widgetServiceName:"kinopoisk"}),r(!0)})()}),[]),(0,a.useEffect)((()=>{t&&W&&W()}),[t,W]),(0,j.jsx)(d.F0,{children:(0,j.jsx)("div",{className:i()(T().modal,e&&T().modalOpened,S&&T().modalSmall),"data-tid":"9a706f5",children:(0,j.jsx)("div",{id:v.Zu,className:i()(T().modalWrapper,S&&T().modalWrapperSmall)})})})}))},62944:function(e,o,t){"use strict";t.d(o,{J:function(){return i}});var a=t(31386),n=t(79337);const r=["isOpenPw","billingFeatureName","target"];function i(){const e=(0,n.useRouter)().query,{isOpenPw:o,billingFeatureName:t,target:i}=e,l="string"===typeof t?t:void 0,s="string"===typeof i?i:void 0;return{queryWithoutPWOptions:(0,a.Z)(e,r),billingFeatureName:l,target:s,shouldOpenWidgetFromQuery:Boolean("1"===o&&s&&l)}}},61144:function(e){e.exports={modal:"styles_modal__pzJRN",modalOpened:"styles_modalOpened__9NkF7",modalWrapper:"styles_modalWrapper___o3ZG",modalSmall:"styles_modalSmall__JTg7B",modalWrapperSmall:"styles_modalWrapperSmall__2mFyO"}}}]);
//# sourceMappingURL=https://kinopoisk-frontend-internal.s3.mds.yandex.net/frontend-www/release/_next/static/chunks/3284.b579906b2b842ef6.js.map